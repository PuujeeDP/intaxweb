@extends('frontend.layouts.app')

@section('content')
    {{-- Hero Slider Section --}}
    @if ($sliders->count() > 0)
        <section class="relative overflow-hidden" x-data="{ currentSlide: 0, totalSlides: {{ $sliders->count() }} }">
            <div class="relative h-[600px] lg:h-[700px]">
                @foreach ($sliders as $index => $slider)
                    <div x-show="currentSlide === {{ $index }}" x-transition:enter="transition ease-out duration-1000"
                        x-transition:enter-start="opacity-0 transform translate-x-full"
                        x-transition:enter-end="opacity-100 transform translate-x-0"
                        x-transition:leave="transition ease-in duration-500"
                        x-transition:leave-start="opacity-100 transform translate-x-0"
                        x-transition:leave-end="opacity-0 transform -translate-x-full" class="absolute inset-0 w-full h-full"
                        style="display: none;">

                        {{-- Background Image --}}
                        @if ($slider->image)
                            <div class="absolute inset-0">
                                <img src="{{ asset('storage/' . $slider->image->file_path) }}" alt="{{ $slider->title }}"
                                    class="w-full h-full object-cover">
                                @if ($slider->button_text && $slider->button_url)
                                    <div
                                        class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-transparent">
                                    </div>
                                @else
                                    <div class="absolute inset-0  to-transparent">
                                    </div>
                                @endif
                            </div>
                        @else
                            <div class="absolute inset-0 bg-gradient-to-br from-green-700 via-green-600 to-green-800"></div>
                        @endif

                        {{-- Content --}}
                        <div class="relative h-full flex items-center">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
                                @if ($slider->button_text && $slider->button_url)
                                    <div class="max-w-3xl">
                                        <h1
                                            class="text-4xl md:text-5xl lg:text-7xl font-extrabold text-white mb-6 leading-tight">
                                            {{ $slider->title }}
                                        </h1>

                                        @if ($slider->subtitle)
                                            <p class="text-xl md:text-2xl text-white/90 mb-4 font-light">
                                                {{ $slider->subtitle }}
                                            </p>
                                        @endif

                                        @if ($slider->description)
                                            <p class="text-lg text-white/80 mb-8 leading-relaxed">
                                                {{ $slider->description }}
                                            </p>
                                        @endif


                                        <a href="{{ $slider->button_url }}" target="{{ $slider->button_target }}"
                                            class="inline-block bg-white text-green-600 px-10 py-4 rounded-lg font-bold text-lg hover:bg-green-50 transition transform hover:scale-105 shadow-xl">
                                            {{ $slider->button_text }}
                                        </a>

                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>
                @endforeach
            </div>

            {{-- Navigation Arrows --}}
            @if ($sliders->count() > 1)
                <button @click="currentSlide = currentSlide === 0 ? totalSlides - 1 : currentSlide - 1"
                    class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 text-white p-3 rounded-full backdrop-blur-sm transition z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>

                <button @click="currentSlide = currentSlide === totalSlides - 1 ? 0 : currentSlide + 1"
                    class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 text-white p-3 rounded-full backdrop-blur-sm transition z-10">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>

                {{-- Dots Navigation --}}
                <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex space-x-2 z-10">
                    @foreach ($sliders as $index => $slider)
                        <button @click="currentSlide = {{ $index }}" class="w-3 h-3 rounded-full transition"
                            :class="currentSlide === {{ $index }} ? 'bg-white' : 'bg-white/50'"></button>
                    @endforeach
                </div>

                {{-- Auto-play Script --}}
                <script>
                    setInterval(() => {
                        const slider = Alpine.$data(document.querySelector('[x-data]'));
                        if (slider) {
                            slider.currentSlide = slider.currentSlide === slider.totalSlides - 1 ? 0 : slider.currentSlide + 1;
                        }
                    }, 5000); // Auto-advance every 5 seconds
                </script>
            @endif
        </section>
    @else
        {{-- Default Hero Section (when no sliders) --}}
        <section class="relative bg-gradient-to-br from-green-700 via-green-600 to-green-800 text-white py-24 overflow-hidden">
            <div class="absolute inset-0 bg-black opacity-10"></div>
            <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-extrabold mb-6 leading-tight">
                    {{ __('frontend.welcome_to') }} <span class="text-green-200">MagicCMS</span>
                </h1>
                <p class="text-xl md:text-2xl text-green-100 mb-10 max-w-3xl mx-auto font-light">
                    {{ __('frontend.professional_cms') }}
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{{ localized_route('posts.index') }}"
                        class="bg-white text-green-600 px-10 py-4 rounded-lg font-bold text-lg hover:bg-green-50 transition transform hover:scale-105 shadow-xl">
                        {{ __('frontend.explore_news') }}
                    </a>
                </div>
            </div>
        </section>
    @endif

    {{-- Featured Posts --}}
    @if ($featuredPosts->count() > 0)
        <section class="py-20 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-4">{{ __('frontend.featured_articles') }}</h2>
                    <div class="w-24 h-1 bg-green-600 mx-auto"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    @foreach ($featuredPosts as $post)
                        <article
                            class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 border-t-4 border-green-600">
                            @if ($post->featuredImage)
                                <a href="{{ localized_route('posts.show', ['slug' => $post->slug]) }}">
                                    <img src="{{ asset('storage/' . $post->featuredImage->file_path) }}"
                                        alt="{{ $post->title }}" class="w-full h-56 object-cover">
                                </a>
                            @else
                                <a href="{{ localized_route('posts.show', ['slug' => $post->slug]) }}">
                                    <div
                                        class="w-full h-56 bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center">
                                        <svg class="w-20 h-20 text-white opacity-40" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z">
                                            </path>
                                        </svg>
                                    </div>
                                </a>
                            @endif

                            <div class="p-6">
                                @if ($post->category)
                                    <a href="{{ localized_route('categories.show', ['slug' => $post->category->slug]) }}"
                                        class="inline-block text-xs font-bold text-green-600 hover:text-green-700 mb-3 uppercase tracking-wider bg-green-50 px-3 py-1 rounded-full">
                                        {{ $post->category->name }}
                                    </a>
                                @endif

                                <h3 class="text-2xl font-bold text-gray-900 mb-3 line-clamp-2">
                                    <a href="{{ localized_route('posts.show', ['slug' => $post->slug]) }}"
                                        class="hover:text-green-600 transition">
                                        {{ $post->title }}
                                    </a>
                                </h3>

                                @if ($post->excerpt)
                                    <p class="text-gray-600 mb-4 line-clamp-3 leading-relaxed">
                                        {{ Str::limit($post->excerpt, 120) }}
                                    </p>
                                @endif

                                <div class="flex items-center justify-between text-sm text-gray-500 pt-4 border-t">
                                    <span class="font-semibold">{{ $post->author->name }}</span>
                                    <span>{{ $post->published_at?->format('M d, Y') }}</span>
                                </div>
                            </div>
                        </article>
                    @endforeach
                </div>
            </div>
        </section>
    @endif

    {{-- Categories --}}
    @if ($categories->count() > 0)
        <section class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-4">{{ __('frontend.browse_by_category') }}</h2>
                    <div class="w-24 h-1 bg-green-600 mx-auto"></div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                    @foreach ($categories as $category)
                        <a href="{{ localized_route('categories.show', ['slug' => $category->slug]) }}"
                            class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-8 text-center hover:shadow-xl transition-all duration-300 group border-2 border-green-200 hover:border-green-600 transform hover:scale-105">
                            <div
                                class="text-4xl font-extrabold text-green-600 mb-3 group-hover:scale-110 transition-transform">
                                {{ $category->posts_count }}
                            </div>
                            <div class="text-gray-800 font-bold text-sm uppercase tracking-wide">{{ $category->name }}
                            </div>
                        </a>
                    @endforeach
                </div>
            </div>
        </section>
    @endif

    {{-- Latest Posts --}}
    @if ($latestPosts->count() > 0)
        <section class="py-20 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between mb-12">
                    <div>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-2">{{ __('frontend.latest_news') }}</h2>
                        <div class="w-24 h-1 bg-green-600"></div>
                    </div>
                    <a href="{{ localized_route('posts.index') }}"
                        class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition shadow-lg">
                        {{ __('frontend.view_all') }} →
                    </a>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    @foreach ($latestPosts as $post)
                        <article
                            class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 border-l-4 border-green-600">
                            @if ($post->featuredImage)
                                <a href="{{ localized_route('posts.show', ['slug' => $post->slug]) }}">
                                    <img src="{{ asset('storage/' . $post->featuredImage->file_path) }}"
                                        alt="{{ $post->title }}" class="w-full h-48 object-cover">
                                </a>
                            @endif

                            <div class="p-6">
                                @if ($post->category)
                                    <a href="{{ localized_route('categories.show', ['slug' => $post->category->slug]) }}"
                                        class="inline-block text-xs font-bold text-green-600 hover:text-green-700 mb-2 uppercase tracking-wider">
                                        {{ $post->category->name }}
                                    </a>
                                @endif

                                <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2">
                                    <a href="{{ localized_route('posts.show', ['slug' => $post->slug]) }}"
                                        class="hover:text-green-600 transition">
                                        {{ $post->title }}
                                    </a>
                                </h3>

                                @if ($post->excerpt)
                                    <p class="text-gray-600 mb-4 line-clamp-2">
                                        {{ Str::limit($post->excerpt, 100) }}
                                    </p>
                                @endif

                                <div class="flex items-center justify-between text-sm text-gray-500">
                                    <span class="font-medium">{{ $post->author->name }}</span>
                                    <span>{{ $post->published_at?->format('M d, Y') }}</span>
                                </div>
                            </div>
                        </article>
                    @endforeach
                </div>
            </div>
        </section>
    @endif

    {{-- Our Clients Section --}}
    @if($clients->count() > 0)
        <section class="py-16 bg-gray-50" x-data="{ selectedTag: 'all' }">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Манай харилцагчид</h2>
                    <p class="text-xl text-gray-600">Бидэнтэй хамтран ажилласан компаниуд</p>
                </div>

                {{-- Tag Filters --}}
                @if(count($clientTags) > 0)
                    <div class="flex flex-wrap justify-center gap-3 mb-12">
                        <button
                            @click="selectedTag = 'all'"
                            :class="selectedTag === 'all' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 hover:bg-green-50'"
                            class="px-6 py-2 rounded-full font-medium transition shadow-sm">
                            Бүгд
                        </button>
                        @foreach($clientTags as $tag)
                            <button
                                @click="selectedTag = '{{ $tag }}'"
                                :class="selectedTag === '{{ $tag }}' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 hover:bg-green-50'"
                                class="px-6 py-2 rounded-full font-medium transition shadow-sm">
                                {{ $tag }}
                            </button>
                        @endforeach
                    </div>
                @endif

                {{-- Clients Grid --}}
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
                    @foreach($clients as $client)
                        <div
                            x-show="selectedTag === 'all' || {{ json_encode($client->tags ?? []) }}.includes(selectedTag)"
                            x-transition:enter="transition ease-out duration-300"
                            x-transition:enter-start="opacity-0 transform scale-95"
                            x-transition:enter-end="opacity-100 transform scale-100"
                            class="bg-white rounded-lg p-6 flex items-center justify-center hover:shadow-lg transition group">
                            @if($client->logo)
                                @if($client->website)
                                    <a href="{{ $client->website }}" target="_blank" rel="noopener noreferrer" class="block w-full h-full">
                                        <img
                                            src="{{ asset('storage/' . $client->logo->file_path) }}"
                                            alt="{{ $client->name }}"
                                            class="max-w-full max-h-20 mx-auto object-contain grayscale group-hover:grayscale-0 transition duration-300"
                                            title="{{ $client->name }}">
                                    </a>
                                @else
                                    <img
                                        src="{{ asset('storage/' . $client->logo->file_path) }}"
                                        alt="{{ $client->name }}"
                                        class="max-w-full max-h-20 mx-auto object-contain grayscale group-hover:grayscale-0 transition duration-300"
                                        title="{{ $client->name }}">
                                @endif
                            @else
                                <div class="text-center">
                                    <p class="text-gray-600 font-semibold">{{ $client->name }}</p>
                                </div>
                            @endif
                        </div>
                    @endforeach
                </div>
            </div>
        </section>
    @endif

    {{-- Testimonials Slider Section --}}
    @if($testimonials->count() > 0)
        <section class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Харилцагчдын сэтгэгдэл</h2>
                    <p class="text-xl text-gray-600">Бидэнтэй хамтран ажилласан харилцагчид юу хэлэх вэ?</p>
                </div>

                {{-- Testimonials Slider with 4 Columns --}}
                <div class="relative" x-data="{
                    currentSlide: 0,
                    totalSlides: {{ ceil($testimonials->count() / 4) }},
                    testimonials: {{ $testimonials->toJson() }},
                    itemsPerSlide: 4,
                    autoplayInterval: null,
                    init() {
                        this.startAutoplay();
                    },
                    startAutoplay() {
                        this.autoplayInterval = setInterval(() => {
                            this.next();
                        }, 5000);
                    },
                    stopAutoplay() {
                        if (this.autoplayInterval) {
                            clearInterval(this.autoplayInterval);
                        }
                    },
                    prev() {
                        this.currentSlide = this.currentSlide === 0 ? this.totalSlides - 1 : this.currentSlide - 1;
                    },
                    next() {
                        this.currentSlide = this.currentSlide === this.totalSlides - 1 ? 0 : this.currentSlide + 1;
                    },
                    getVisibleTestimonials() {
                        const start = this.currentSlide * this.itemsPerSlide;
                        return this.testimonials.slice(start, start + this.itemsPerSlide);
                    }
                }" @mouseenter="stopAutoplay()" @mouseleave="startAutoplay()">

                    {{-- Testimonials Grid --}}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <template x-for="(testimonial, index) in getVisibleTestimonials()" :key="testimonial.id">
                            <div class="bg-gray-50 rounded-lg p-6 shadow-md hover:shadow-xl transition duration-300"
                                 x-transition:enter="transition ease-out duration-300"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100">

                                {{-- Quote Icon --}}
                                <div class="text-green-600 text-4xl mb-4">"</div>

                                {{-- Content --}}
                                <p class="text-gray-700 mb-6 line-clamp-4" x-text="testimonial.content"></p>

                                {{-- Rating Stars --}}
                                <div class="flex mb-4">
                                    <template x-for="star in 5" :key="star">
                                        <svg :class="star <= testimonial.rating ? 'text-yellow-400' : 'text-gray-300'"
                                             class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                    </template>
                                </div>

                                {{-- Client Info --}}
                                <div class="flex items-center">
                                    <template x-if="testimonial.client_photo">
                                        <img :src="`/storage/${testimonial.client_photo.file_path}`"
                                             :alt="testimonial.client_name"
                                             class="w-12 h-12 rounded-full object-cover mr-4">
                                    </template>
                                    <template x-if="!testimonial.client_photo">
                                        <div class="w-12 h-12 rounded-full bg-green-600 flex items-center justify-center text-white font-bold mr-4"
                                             x-text="testimonial.client_name.charAt(0).toUpperCase()">
                                        </div>
                                    </template>
                                    <div>
                                        <p class="font-semibold text-gray-900" x-text="testimonial.client_name"></p>
                                        <template x-if="testimonial.client_position">
                                            <p class="text-sm text-gray-600" x-text="testimonial.client_position"></p>
                                        </template>
                                        <template x-if="testimonial.client_company">
                                            <p class="text-sm text-gray-500" x-text="testimonial.client_company"></p>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    {{-- Navigation Arrows --}}
                    <template x-if="totalSlides > 1">
                        <div class="flex justify-center items-center gap-4">
                            <button @click="prev()"
                                    class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-full transition shadow-md">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>

                            {{-- Slide Indicators --}}
                            <div class="flex gap-2">
                                <template x-for="(slide, index) in totalSlides" :key="index">
                                    <button @click="currentSlide = index"
                                            :class="currentSlide === index ? 'bg-green-600 w-8' : 'bg-gray-300 w-3'"
                                            class="h-3 rounded-full transition-all duration-300">
                                    </button>
                                </template>
                            </div>

                            <button @click="next()"
                                    class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-full transition shadow-md">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                    </template>
                </div>
            </div>
        </section>
    @endif

@endsection
